## Fileformat

A set of libraries and tools for representation, manipulation, and analysis of binary files in various object file formats.

This repository contains the following libraries:
* `ar-extractor` -- library for extracting object files from archives (based on LLVM).
* `cpdetect` -- library for compiler and packer detection in binaries.
* `crypto` -- collection of cryptographic functions.
* `fileformat` -- library for parsing and uniform representation of various object file formats. Currently supporting the following formats: COFF, ELF, Intel HEX, Mach-O, PE, raw data.
* `loader` -- library for uniform representation of binaries loaded to memory. Supports the same formats as `fileformat`.
* `macho-extractor` -- library for extracting regular Mach-O binaries from fat Mach-O binaries (based on LLVM).
* `unpacker` -- collection of unpacking functions.

This repository contains the following tools:
* `ar-extractortool` -- frontend for the `ar-extractor` library.
* `fileinfo` -- binary analysis tool. Supports the same formats as `fileformat`.
* `macho-extractortool` -- frontend for the `macho-extractor` library.
* `unpackertool` -- plugin-based unpacker

## Usage Example

### Ar-Extractor Library

For usage examples of the Ar-Extractor library, see the implementation of Ar-Extractortool (in `src/ar-extractortool`).

### CPdetect Library

For usage examples of the CPdetect library, see the implementation of Fileinfo (in `src/fileinfo`).

### Crypto Library

For usage examples of Crypto library, see the implementation of Fileinfo (in `src/fileinfo`).

### Fileformat Library

For usage examples of the Fileformat library, see the implementation of Fileinfo (in `src/fileinfo`) and Fileformat unit tests (in `tests/fileformat`).

### Loader Library

For usage examples of the Loader library, see the implementation of Loader unit tests (in `tests/loader`).

### Macho-Extractor Library

For usage examples of the Macho-Extractor library, see the implementation of Macho-Extractortool (in `src/macho-extractortool`).

### Unpacker Library

For usage examples of Unpacker library, see the implementation of Unpackertool (in `src/unpackertool`) and Unpacker unit tests (in `tests/unpacker`).

### Ar-Extractor Tool

Run `./ar-extractor --help` to list all the available options.

### Fileinfo Tool

To dump basic information about binary `test.bin` to `stdout` run:
```
./fileinfo test.bin
```

To dump all the information about binary `test.bin` to `stdout` run:
```
./fileinfo --verbose test.bin
```

Run `./fileinfo --help` to list all the available options.

### Macho-Extractor Tool

Run `./macho-extractor --help` to list all the available options.

### Unpacker Tool

Run `./unpacker --help` to list all the available options.

## Requirements

* A compiler supporting C++14
  * On Windows, only Microsoft Visual C++ is supported (version >= Visual Studio 2015).
* CMake (version >= 3.6)
* Perl
  * On Windows, [Active Perl](https://www.activestate.com/activeperl) needs to be the first Perl in `PATH`, or it has to be provided to CMake using `CMAKE_PROGRAM_PATH` variable, e.g. `-DCMAKE_PROGRAM_PATH=/c/perl/bin`.

## Build and Installation

* Recursively clone the repository (it contains submodules):
  * `git clone --recursive https://github.com/avast-tl/fileformat`
* Linux:
  * `cd fileformat`
  * `mkdir build && cd build`
  * `cmake .. -DCMAKE_INSTALL_PREFIX=<path>`
  * `make && make install`
* Windows:
  * Open MSBuild command prompt, or any terminal that is configured to run the `msbuild` command.
  * `cd fileformat`
  * `mkdir build && cd build`
  * `cmake .. -DCMAKE_INSTALL_PREFIX=<path> -G<generator>`
  * `msbuild /m /p:Configuration=Release fileformat.sln`
  * `msbuild /m /p:Configuration=Release INSTALL.vcxproj`
  * Alternatively, you can open `fileformat.sln` generated by `cmake` in Visual Studio IDE.

You must pass the following parameters to `cmake`:
* `-DCMAKE_INSTALL_PREFIX=<path>` to set the installation path to `<path>`.
* (Windows only) `-G<generator>` is `-G"Visual Studio 14 2015"` for 32-bit build using Visual Studio 2015, or `-G"Visual Studio 14 2015 Win64"` for 64-bit build using Visual Studio 2015. Later versions of Visual Studio may be used.

You can pass the following additional parameters to `cmake`:
* `-DFILEFORMAT_DOC=ON` to build with API documentation (requires Doxygen and Graphviz, disabled by default).
* `-DFILEFORMAT_TESTS=ON` to build with tests (disabled by default).
* `-DCMAKE_BUILD_TYPE=Debug` to build with debugging information, which is useful during development. By default, the project is built in the `Release` mode. This has no effect on Windows, but the same thing can be achieved by running `msbuild` with the `/p:Configuration=Debug` parameter.
* `-DCMAKE_PROGRAM_PATH=<path>` to use Perl at `<path>` (probably useful only on Windows).

## Library Use

### Adding Fileformat libraries to your project via git submodule

The following list of library targets is exposed: `ar-extractor`, `cpdetect`, `crypto`, `fileformat`, `loader`, `macho-extractor`, `unpacker`.
They can be used as follows:
```cmake
target_link_libraries(project-that-needs-ar-extractor ar-extractor)
target_link_libraries(project-that-needs-cpdetect cpdetect)
target_link_libraries(project-that-needs-crypto crypto)
target_link_libraries(project-that-needs-fileformat fileformat)
target_link_libraries(project-that-needs-loader loader)
target_link_libraries(project-that-needs-macho-extractor macho-extractor)
target_link_libraries(project-that-needs-unpacker unpacker)
```

### Using Fileformat libraries via CMake `find_package` command

Not supported at the moment.

## API Documentation

You can generate the API documentation by yourself. Pass `-DFILEFORMAT_DOC=ON` to `cmake` and run `make doc`.

## License

Copyright (c) 2017 Avast Software, licensed under the MIT license. See the `LICENSE` file for more details.

Fileformat uses third-party libraries or other resources listed, along with their licenses, in the `LICENSE-THIRD-PARTY` file.

## Contributing

See [RetDec contribution guidelines](https://github.com/avast-tl/retdec/wiki/Contribution-Guidelines).

## Acknowledgements

This software was supported by the research funding TACR (Technology Agency of the Czech Republic), ALFA Programme No. TA01010667.
